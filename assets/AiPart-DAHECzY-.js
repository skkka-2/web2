import{r,o as M,m as u,U as e,F as p,a1 as _,t as w,a0 as q,a7 as B,l as d,aa as z,n as x,P as H}from"./index-2FQzjx0d.js";import{r as m}from"./request-C_-kUrdW.js";import"./user-JnvrzQXz.js";const D=({content:n,userID:c})=>m.post("/mainPart/ai",{content:n,userID:c}),P=({userID:n})=>m.post("/mainPart/getChatHistory",{userID:n}),A=({userID:n})=>m.post("/mainPart/clearChatHistory",{userID:n}),I={class:"title"},U={id:"box"},L=["onClick"],S=["onUpdate:modelValue"],F={class:"chat-container"},K={class:"chat-box",id:"chatBox"},T={class:"messages",id:"chatContainer"},Z={class:"input-area"},E=["disabled"],G=["disabled"],J={__name:"AiPart",setup(n){const c=r(""),s=r([]),v=r(!1);r(!1);const h=localStorage.getItem("userID"),C=async l=>{try{const t=await P({userID:l});t.status===200&&(s.value=t.data.messages||[],console.log(t.data.messages),console.log(s.value))}catch(t){console.error("加载聊天记录错误:",t)}},b=r("小智为你答疑解惑"),g=r(b.value.split("")),i=r(new Array(g.value.length).fill(!1)),k=l=>{i.value[l]=!i.value[l]};M(()=>{C(h)});const y=async()=>{const l=c.value.trim();if(l!==""){if(console.log(s.value),!Array.isArray(s.value)){console.error("messages.value 不是数组！");return}s.value.push({type:"user",text:l}),c.value="",v.value=!0;try{const t=await D({content:l,userID:h});if(t.status!==200){const a=t.data;s.value.push({type:"ai",text:a.error||"服务器错误，请稍后重试！"});return}const o=t.data.res;s.value.push({type:"ai",text:o})}catch(t){console.error("请求错误:",t),s.value.push({type:"ai",text:"对不起，无法访问服务器"})}finally{v.value=!1}}},V=async()=>{try{await A({userID:h}),s.value=[]}catch{console.error("清除聊天记录错误:",error)}finally{}};return(l,t)=>(d(),u(p,null,[e("div",I,[e("div",U,[(d(!0),u(p,null,_(g.value,(o,a)=>(d(),u("div",{key:a,class:"child",onClick:f=>k(a)},[w(e("input",{type:"checkbox","onUpdate:modelValue":f=>i.value[a]=f,style:{display:"none"}},null,8,S),[[z,i.value[a]]]),e("div",{class:x(["item",{glow:i.value[a]}])},H(o),3)],8,L))),128))])]),e("div",F,[e("div",K,[e("div",T,[(d(!0),u(p,null,_(s.value,(o,a)=>(d(),u("div",{key:a,class:"chat-message"},[e("div",{class:x(o.type==="user"?"user-message":"ai-message")},[e("p",null,H(o.text),1)],2)]))),128))])]),e("div",Z,[e("div",{class:"clear",onClick:V},t[1]||(t[1]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"2em",height:"2em",viewBox:"0 0 1024 1024"},[e("path",{fill:"#0891b2",d:"m899.1 869.6l-53-305.6H864c14.4 0 26-11.6 26-26V346c0-14.4-11.6-26-26-26H618V138c0-14.4-11.6-26-26-26H432c-14.4 0-26 11.6-26 26v182H160c-14.4 0-26 11.6-26 26v192c0 14.4 11.6 26 26 26h17.9l-53 305.6c-.3 1.5-.4 3-.4 4.4c0 14.4 11.6 26 26 26h723c1.5 0 3-.1 4.4-.4c14.2-2.4 23.7-15.9 21.2-30M204 390h272V182h72v208h272v104H204zm468 440V674c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v156H416V674c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v156H202.8l45.1-260H776l45.1 260z"})],-1)])),w(e("input",{type:"text",class:"input-field","onUpdate:modelValue":t[0]||(t[0]=o=>c.value=o),placeholder:"请发消息~您的小助手已上线",onKeyup:B(y,["enter"]),disabled:v.value},null,40,E),[[q,c.value]]),e("button",{class:"send-button",onClick:y,disabled:v.value},t[2]||(t[2]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1.5em",height:"1.5em",viewBox:"0 0 24 24"},[e("g",{fill:"none"},[e("path",{d:"m12.593 23.258l-.011.002l-.071.035l-.02.004l-.014-.004l-.071-.035q-.016-.005-.024.005l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.017-.018m.265-.113l-.013.002l-.185.093l-.01.01l-.003.011l.018.43l.005.012l.008.007l.201.093q.019.005.029-.008l.004-.014l-.034-.614q-.005-.018-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.004-.011l.017-.43l-.003-.012l-.01-.01z"}),e("path",{fill:"#ffffff",d:"M20.25 3.532a1 1 0 0 1 1.183 1.329l-6 15.5a1 1 0 0 1-1.624.362l-3.382-3.235l-1.203 1.202c-.636.636-1.724.186-1.724-.714v-3.288L2.309 9.723a1 1 0 0 1 .442-1.691l17.5-4.5Zm-2.114 4.305l-7.998 6.607l3.97 3.798zm-1.578-1.29L4.991 9.52l3.692 3.53l7.875-6.505Z"})])],-1)]),8,G)])])],64))}};export{J as default};
